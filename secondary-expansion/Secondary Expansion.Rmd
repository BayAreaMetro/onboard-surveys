---
title: "Secondary Expansion"
output: html_notebook
---

# Overhead
```{r overhead, include = FALSE}
packages_vector <- c("tidyverse",
                     "reticulate",
                     "reshape",
                     "reshape2",
                     "ggplot2",
                     "scales",
                     "plotly",
                     "htmlwidgets")

need_to_install <- packages_vector[!(packages_vector %in% installed.packages()[,"Package"])]

if (length(need_to_install)) install.packages(need_to_install)

for (package in packages_vector){
  library(package, character.only = TRUE)
}

```

# Conda config
```{bash}
conda create -n mtc_obs python=3.7
conda install cytoolz numpy pandas psutil pytables future
conda activate mtc_obs 
conda install cytoolz numpy pandas psutil pytables future
pip install activitysim 
pip install https://github.com/RSGInc/populationsim/zipball/master
```

# Python Config
```{r python-config}
use_condaenv("mtc_obs")
```

# Pre-process
```{r pre-game}
POPSIM_Dir      <- "."

# START HERE AND UPDATE THE DIRECTORIES

BOX_SYNC_Dir    <- file.path(trimws(args[2]))

OBS_Dir         <- file.path(BOX_SYNC_Dir, "Survey_Database_122717")
BOX_TM2_Dir     <- file.path(BOX_SYNC_Dir, "Travel Model Two Development")
OBS_Anc_Dir     <- file.path(BOX_TM2_Dir, "Observed Data", "Transit", "Onboard Survey", "Data")
TARGETS_Dir     <- file.path(BOX_TM2_Dir, "Observed Data", "Transit", "Scaled Transit Ridership Targets")
VALIDATION_Dir  <- file.path(POPSIM_Dir, "validation")

source("preprocess.R")
```

# PopulationSim
```{python}
run_populationsim.py
```

# Post-process
```{r post-game}
source("postprocess.R")
```

